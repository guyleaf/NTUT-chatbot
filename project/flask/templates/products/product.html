{% extends "base.html" %}
{% set title = "編輯商品" if is_seller else "商品資訊" %}
{% set action = "{{ url_for('resources.products.product_page', product_id=product.id) }}" if is_seller else "/orders" %}
{% set method = "PUT" if is_seller else "POST"%}

{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="container">
    <h1 class="title">{{ title }}</h1>
    <div class="text-center mb-3">
        <img
            class="img-thumbnail"
            src="{{ product.image_url }}"
            width="450px"
            alt="Product image"
        />
    </div>
    <form action="{{ action }}" method="{{ method }}">
        <div class="row justify-content-md-center mb-3">
            <label for="name" class="col-sm-3 col-form-label">名稱：</label>
            <div class="col">
                <input class="{{ 'form-control-plaintext' if not is_seller else 'form-control' }}" type="text" id="name" name="name" value="{{ product.name }}" {{ 'readonly' if not is_seller else '' }}>
            </div>
        </div>
        <div class="row justify-content-md-center mb-3">
            <label for="brand" class="col-sm-3 col-form-label">品牌：</label>
            <div class="col">
                <input class="{{ 'form-control-plaintext' if not is_seller else 'form-control' }}" type="text" name="brand" value="{{ product.brand }}" {{ 'readonly' if not is_seller else '' }}>
            </div>
        </div>
        <div class="row justify-content-md-center mb-3">
            <label for="description" class="col-sm-3 col-form-label">說明：</label>
            <div class="col">
                <input class="{{ 'form-control-plaintext' if not is_seller else 'form-control' }}" type="text" name="description" value="{{ product.description }}" {{ 'readonly' if not is_seller else '' }}>
            </div>
        </div>
        <div class="row justify-content-md-center mb-3">
            <label for="price" class="col-sm-3 col-form-label">商店價格：</label>
            <div class="col">
                <input class="{{ 'form-control-plaintext' if not is_seller else 'form-control' }}" type="number" name="price" value="{{ product.price }}" {{ 'readonly' if not is_seller else '' }}>
            </div>
        </div>
        <div class="row justify-content-md-center mb-3">
            <label for="quantity" class="col-sm-3 col-form-label">剩餘數量：</label>
            <div class="col">
                {% if is_seller %}
                    <input class="form-control" type="number" name="quantity" value="{{ product.status.quantity }}">
                {% else %}
                    {% if product.status.quantity > 0 %}
                        <label class="align-middle fw-bold text-success">{{ product.status.quantity }}</label>
                    {% else %}
                        <label class="align-middle fw-bold text-danger">缺貨中</label>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        {% if not is_seller and product.status.quantity > 0 %}
            <div class="row justify-content-md-center mb-3">
                <label for="quantity" class="col-sm-3 col-form-label">購買數量：</label>
                <div class="col">
                    <input class="form-control" type="number" name="quantity">
                </div>
            </div>
        {% endif %}

        {% if is_seller %}
            <div class="row justify-content-md-center mb-3">
                <label for="quantity" class="col-sm-3 col-form-label">商品狀態：</label>
                <div class="col">
                    <select class="form-select" aria-label="is product available">
                        <option {{ 'selected' if product.status.is_available else '' }} value="true">上架中</option>
                        <option {{ 'selected' if not product.status.is_available else '' }} value="false">下架中</option>
                    </select>
                </div>
            </div>
        {% endif %}

        <div class="row justify-content-md-center mb-5">
            {% if is_seller or product.status.quantity > 0 %}
                <div class="col text-center">
                    <button class="btn btn-primary" type="submit">{{ '更新' if is_seller else '購買' }}</button>
                </div>
                {% if is_seller %}
                    <div class="col text-center">
                        <button class="btn btn-danger" type="submit">刪除</button>
                    </div>
                {% endif %}
                <div class="col text-center">
                    <a role="button" class="btn btn-secondary" href="{{ url_for('resources.products.search_page') }}">取消</a>
                </div>
            {% else %}
                <div class="col text-center">
                    <a role="button" class="btn btn-primary" href="{{ url_for('resources.products.search_page') }}">返回搜尋頁面</a>
                </div>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}
{% block scripts %}
    <script
        type="text/javascript"
        src="{{ url_for('static', filename='js/product.js') }}"
    ></script>
{% endblock %}